# GPU Queue Clear Feature

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞–Ω–∏–π –Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ (Vast.ai instance).

## –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. Backend (GPU Server)

**–§–∞–π–ª:** `upscale/vastai_deployment/server.py`

–î–æ–±–∞–≤–ª–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö endpoint'–∞:

#### `POST /clear_queue`
–û—á–∏—â–∞–µ—Ç –≤—Å—é –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞–Ω–∏–π –Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ.

**Response:**
```json
{
  "ok": true,
  "message": "Queue cleared successfully",
  "cleared": {
    "total": 5,
    "pending": 3,
    "processing": 2
  }
}
```

#### `GET /queue_status`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ GPU.

**Response:**
```json
{
  "total_jobs": 5,
  "status_counts": {
    "pending": 3,
    "processing": 2
  },
  "jobs": [
    {
      "job_id": 1,
      "status": "processing",
      "type": "upscale"
    }
  ]
}
```

### 2. Frontend API Client

**–§–∞–π–ª:** `web/src/lib/upscale.ts`

–î–æ–±–∞–≤–ª–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–∏:

- `clearGpuQueue()` - –æ—á–∏—â–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å –Ω–∞ GPU
- `getGpuQueueStatus()` - –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏ GPU

### 3. Frontend UI

**–§–∞–π–ª:** `web/src/app/page.tsx`

–ù–∞ –≤–∫–ª–∞–¥–∫–µ **Upscale** –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞:
- **"–û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å GPU"** —Å –æ—Ä–∞–Ω–∂–µ–≤—ã–º —Å—Ç–∏–ª–µ–º
- –ë–µ–π–¥–∂ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥)
- –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç—É–ª—Ç–∏–ø —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–¥–∞—á
- –ü—Ä–∏ –∫–ª–∏–∫–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ù–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É **Upscale**
2. –°–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É —É–≤–∏–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"–û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å GPU"**
3. –ï—Å–ª–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –µ—Å—Ç—å –∑–∞–¥–∞—á–∏, –Ω–∞ –∫–Ω–æ–ø–∫–µ –±—É–¥–µ—Ç –æ—Ä–∞–Ω–∂–µ–≤—ã–π –±–µ–π–¥–∂ —Å —á–∏—Å–ª–æ–º
4. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ
5. –í—Å–µ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ GPU –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã

### –ß–µ—Ä–µ–∑ API

#### –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
```bash
curl -X POST http://YOUR_GPU_SERVER:5000/clear_queue
```

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏
```bash
curl http://YOUR_GPU_SERVER:5000/queue_status
```

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–ª–µ–∑–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. **–ó–∞—Å—Ç—Ä—è–≤—à–∏–µ –∑–∞–¥–∞—á–∏** - –∫–æ–≥–¥–∞ –∑–∞–¥–∞—á–∏ –≤–∏—Å—è—Ç –≤ –æ—á–µ—Ä–µ–¥–∏ –∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
2. **–û—à–∏–±–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏** - –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—à–∏–±–æ—á–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞** - –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º GPU —Å–µ—Ä–≤–µ—Ä–∞
4. **–û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - —É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–¥–∞–Ω–∏–π

## –í–∞–∂–Ω–æ

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ:**
- –≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –æ—á–∏—â–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å **–Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ** (Vast.ai)
- –≠—Ç–æ –ù–ï —É–¥–∞–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (PostgreSQL)
- –ó–∞–¥–∞—á–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (—Ç–∞–±–ª–∏—Ü–∞ `upscaletask`) –æ—Å—Ç–∞—é—Ç—Å—è –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
- –î–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **"–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ"** (–∫—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞)

## –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∫–Ω–æ–ø–∫–∞–º–∏

| –ö–Ω–æ–ø–∫–∞ | –ß—Ç–æ –æ—á–∏—â–∞–µ—Ç | –£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª—ã | –¶–≤–µ—Ç |
|--------|-------------|---------------|------|
| **–û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å GPU** | –¢–æ–ª—å–∫–æ –æ—á–µ—Ä–µ–¥—å –Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ | –ù–µ—Ç | üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π |
| **–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ** | –õ–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ + —Ñ–∞–π–ª—ã –≤ to_upscale | –î–∞ | üî¥ –ö—Ä–∞—Å–Ω—ã–π |

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏ GPU –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
- –ù–∞ –±–µ–π–¥–∂–µ –∫–Ω–æ–ø–∫–∏
- –í —Ç—É–ª—Ç–∏–ø–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫

1. Frontend –≤—ã–∑—ã–≤–∞–µ—Ç `getUpscaleSettings()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `VAST_UPSCALE_URL`
2. –î–µ–ª–∞–µ—Ç GET –∑–∞–ø—Ä–æ—Å –∫ `{VAST_UPSCALE_URL}/queue_status`
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ —á–µ—Ä–µ–∑ `setInterval`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- –ï—Å–ª–∏ GPU —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Å—á–µ—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è alert —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. GPU —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
2. `VAST_UPSCALE_URL` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `.env`
3. CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ (Flask –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –°—á–µ—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. GPU —Å–µ—Ä–≤–µ—Ä –≤—ã–∫–ª—é—á–µ–Ω
2. –ù–µ–≤–µ—Ä–Ω—ã–π `VAST_UPSCALE_URL`
3. –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–µ–∂–¥—É frontend –∏ GPU

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –¥–ª—è –æ—à–∏–±–æ–∫.

### –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∑–∞–¥–∞—á–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –ö–Ω–æ–ø–∫–∞ –æ—á–∏—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—á–µ—Ä–µ–¥—å –Ω–∞ GPU —Å–µ—Ä–≤–µ—Ä–µ. –î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É **"–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ"** –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ –∑–∞–¥–∞—á–∏ –ø–æ –æ–¥–Ω–æ–π.

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞:

1. **GPU —Å–µ—Ä–≤–µ—Ä** - –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
# –ù–∞ Vast.ai instance
systemctl restart vast-upscale.service
```

2. **Frontend** - –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å (–µ—Å–ª–∏ production):
```bash
cd web
npm run build
npm run start
```

–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ dev —Ä–µ–∂–∏–º–µ.

## API Examples

### Python
```python
import requests

# Clear queue
response = requests.post('http://74.208.193.3:5000/clear_queue')
print(response.json())

# Get status
response = requests.get('http://74.208.193.3:5000/queue_status')
print(response.json())
```

### cURL
```bash
# Clear queue
curl -X POST http://74.208.193.3:5000/clear_queue

# Get status
curl http://74.208.193.3:5000/queue_status
```

### JavaScript
```javascript
// Clear queue
const result = await fetch('http://74.208.193.3:5000/clear_queue', {
  method: 'POST'
});
console.log(await result.json());

// Get status
const status = await fetch('http://74.208.193.3:5000/queue_status');
console.log(await status.json());
```
